#!/bin/bash
# ============================================================
# MindCast 데이터 증강 실행 스크립트
#
# 전략: 분노(anchor) 기준으로 5감정(슬픔,불안,상처,당황,기쁨)을
#       분노 개수까지 맞추는 anchor-based 생성
#
# 뉴스 타이틀: MindCastSogang/Youtube_news_preprocessed_data
# 기존 데이터: MindCastSogang/MindCastTrainSet (감정별 분포 참고)
# ============================================================

set -e

# 프로젝트 루트로 이동
cd "$(dirname "$0")/.."
echo "[INFO] Working directory: $(pwd)"

# ============================================================
# API 키 로드 (.env 파일에서)
# ============================================================
ENV_FILE="data_augmentator/.env"
if [ -f "$ENV_FILE" ]; then
    set -a
    source "$ENV_FILE"
    set +a
    echo "[INFO] API 키 로드 완료: $ENV_FILE"
else
    echo "[WARN] .env 파일 없음: $ENV_FILE (환경변수에서 직접 설정 필요)"
fi

# ============================================================
# 1. Dry Run: 생성 계획 확인 (API 호출 없음)
# ============================================================
echo ""
echo "=========================================="
echo "[STEP 1] Anchor-based 생성 계획 확인 (dry-run)"
echo "=========================================="
python scripts/augment_data.py --dry-run

# ============================================================
# 2. 실제 생성 실행
# ============================================================
echo ""
echo "=========================================="
echo "[STEP 2] 데이터 증강 실행 (anchor-based)"
echo "=========================================="
python scripts/augment_data.py

# ============================================================
# 3. (선택) HuggingFace Hub에 업로드
# ============================================================
# echo ""
# echo "=========================================="
# echo "[STEP 3] HuggingFace Hub 업로드"
# echo "=========================================="
# python scripts/augment_data.py --push

echo ""
echo "[DONE] 데이터 증강 완료"
echo "체크포인트: augmentation_checkpoints/"
